<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ì‘ì • ëœë¤ì—¬í–‰í•˜ê¸°!</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#A2D2FC',
                        'primary-dark': '#8BB9E0',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <script th:src="@{'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${appKey} + '&libraries=services&autoload=false'}"></script>
    <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

    <script
            src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.5/kakao.min.js"
            integrity="sha384-dok87au0gKqJdxs7msEdBPNnKSRT+/mhTVzq+qOhcL464zXwvcrpjeWvyj1kCdq6"
            crossorigin="anonymous"
    ></script>
</head>
<body>

<header class="page-header">
    ë¬´ì‘ì • ëœë¤ì—¬í–‰í•˜ê¸°!
    <span id="info-btn" class="float-right text-sm font-normal py-1 px-2 bg-white text-black rounded cursor-pointer">ì„¤ëª…ë³´ê¸°</span>
</header>

<main class="pb-8">
    <section class="p-4">
        <p class="text-center text-gray-600 text-sm mb-4">
            ëœë¤ìœ¼ë¡œ ì—¬í–‰ì§€ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”!<br>
            ì„ íƒëœ ì§€ì—­ì— ì–´ìš¸ë¦¬ëŠ” ì½”ìŠ¤ë¿ë§Œ ì•„ë‹ˆë¼ ìˆ™ì†Œ, ì‹ë‹¹ë„ ì¶”ì²œë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>

        <div class="map-container relative" style="height: 500px;">
            <div id="vmap" class="absolute top-0 left-0 w-full h-full"></div>
        </div>

        <!-- í…Œë§ˆ ì„ íƒ -->
        <div class="flex flex-col md:flex-row justify-center items-start gap-4 mt-4 max-w-3xl mx-auto">
            <select id="theme-select" class="border rounded px-4 py-2 text-sm w-full md:w-60">
                <option value="random">ëª¨ë‘ ëœë¤ìœ¼ë¡œ ì¶”ì²œë°›ê¸°</option>
<!--                <option value="region">ì§€ì—­ë³„ ì—¬í–‰ì§€ ì¶”ì²œë°›ê¸°</option>-->
<!--                <option value="season">ê³„ì ˆë³„ ì—¬í–‰ì§€ ì¶”ì²œë°›ê¸°</option>-->
<!--                <option value="mbti">MBTIë³„ ì¶”ì²œë°›ê¸°</option>-->
            </select>
            <!-- ì§€ì—­ ì„ íƒ -->
            <div id="theme-options" class="hidden flex-col gap-2 w-full md:w-60">
                <select id="region-select" class="border rounded px-4 py-2 text-sm hidden">
                    <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                    <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                    <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                    <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                    <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                    <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                    <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                    <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                    <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                    <option value="ê°•ì›ë„">ê°•ì›ë„</option>
                    <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                    <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                    <option value="ì „ë¼ë¶ë„">ì „ë¼ë¶ë„</option>
                    <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                    <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                    <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                    <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>

                </select>
                <!-- ê³„ì ˆ ì„ íƒ -->
                <select id="season-select" class="border rounded px-4 py-2 text-sm hidden">
                    <option value="spring">ë´„</option>
                    <option value="summer">ì—¬ë¦„</option>
                    <option value="autumn">ê°€ì„</option>
                    <option value="winter">ê²¨ìš¸</option>
                </select>
                <!-- MBTI ì„ íƒ -->
                <select id="mbti-select" class="border rounded px-4 py-2 text-sm hidden">
                    <option value="INTJ">INTJ</option>
                    <option value="INTP">INTP</option>
                    <option value="ENTJ">ENTJ</option>
                    <option value="ENTP">ENTP</option>
                    <option value="INFJ">INFJ</option>
                    <option value="INFP">INFP</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENFP">ENFP</option>
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                </select>
            </div>
        </div>

        <div class="mt-4">
            <button id="recommend-btn" class="btn btn-primary w-full py-2 text-sm max-w-md mx-auto block">
                ëœë¤ ì—¬í–‰ì§€ ì¶”ì²œ
            </button>
        </div>

        <h4 class="text-3xl font-semibold text-center my-4">
            ì¶”ì²œ ê²°ê³¼ëŠ”......
        </h4>
        <!-- ê²°ê³¼ ì„¹ì…˜: ì²˜ìŒì—” ìˆ¨ê²¨ë‘ê³ , JSì—ì„œ ë³´ì—¬ì¤Œ -->
        <section id="result-section" class="p-4" style="display:none;">
            <p id="result-text" class="text-center font-bold mb-1">
                <!-- JSê°€ ì´ ì•ˆì„ ì±„ì›Œë„£ìŠµë‹ˆë‹¤ -->
            </p>
            <p class="text-center mb-4">
                <span id="result-course" class="font-medium"></span> ì½”ìŠ¤ í•œë²ˆ ê°€ë³´ì‹¤ë˜ìš”?
            </p>
        </section>

    <!-- íƒ­ ë²„íŠ¼ ë¶€ë¶„ -->
    <div class="tab-container mt-4">
        <div id="tab-course" class="tab active">ì—¬í–‰ì½”ìŠ¤</div>
        <div id="tab-restaurant" class="tab">ì‹ë‹¹</div>
        <div id="tab-accommodation" class="tab">ìˆ™ì†Œ</div>
    </div>


        <!-- Course List -->
            <section id="content-course" class="p-4">
                <div id="course-list" class="space-y-3">
                </div>
            </section>
        <!-- ì‹ë‹¹ -->
        <section id="content-restaurant" class="p-4 hidden">
            <div id="restaurant-list" class="space-y-3"></div>
        </section>

        <!-- ìˆ™ì†Œ -->
        <section id="content-accommodation" class="p-4 hidden">
            <div id="accommodation-list" class="space-y-3"></div>
        </section>

        <p class="flex justify-center text-xs text-gray-500 mt-4 px-2">
           ìˆ™ì†Œ,ì‹ë‹¹ í•­ëª©ì—ì„œ ìƒì„¸ë³´ê¸°ë¥¼ í´ë¦­í•˜ì—¬ ë„¤ì´ë²„ì§€ë„ì—ì„œ  í™•ì¸í•´ë³´ì„¸ìš”!.<br>
        </p>
    </section>
    <!-- ìƒì„¸ ëª¨ë‹¬ -->
    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl relative">
            <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-black text-lg font-bold">ë‹«ê¸°</button>
            <div class="flex flex-col md:flex-row gap-6">
                <img id="modal-img" src="" alt="Detail Image" class="w-full md:w-1/2 h-64 object-cover rounded-lg">
                <div class="flex-1 flex flex-col justify-between">
                    <div>
                        <h2 id="modal-title" class="text-2xl font-bold mb-2">ì œëª©</h2>
                        <div class="flex items-center gap-2 text-gray-600">

                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 border-t pt-4">
                <p id="modal-desc" class="text-sm text-gray-700 leading-relaxed whitespace-pre-line"></p>
            </div>
        </div>

    </div>

<!--    <div class="flex justify-center">-->
<!--        <a-->
<!--                id="kakaotalk-sharing-btn"-->
<!--                class="kakao-btn inline-flex items-center justify-center px-6 py-2 gap-2 text-center"-->
<!--                href="javascript:;"-->
<!--        >-->
<!--            <img-->
<!--                    src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png"-->
<!--                    alt="ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë³´ë‚´ê¸° ë²„íŠ¼"-->
<!--                    class="h-5 w-auto"-->
<!--            />-->
<!--            ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê²°ê³¼ ê³µìœ í•˜ê¸°-->
<!--        </a>-->
<!--    </div>-->

    <!-- hot section -->

    <div class="w-full mx-auto px-4 py-6"> <h3 class="text-lg font-bold text-black mb-4">ìµœê·¼ ë§ì´ ê³µìœ ëœ í•«ìŠ¤íŒŸ!ğŸ”¥ğŸ”¥</h3>
        <div id="Hotcontent-course" class="my-3 flex flex-wrap justify-center"></div>
        <div id="Hotcontent-restaurant" class="my-3 flex flex-wrap justify-center"></div>
        <div id="Hotcontent-accommodation" class="my-3 flex flex-wrap justify-center"></div>
    </div>
    <!-- ì„¤ëª… ëª¨ë‹¬ -->
    <div id="info-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-md w-[90%] relative">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button id="modal-close-btn" class="absolute top-4 right-4 text-gray-500 hover:text-black text-lg font-bold">
                ë‹«ê¸°
            </button>

            <div class="space-y-6 text-sm text-gray-700 leading-relaxed">
                <div>
                    <img src="/images/category.png" alt="ì¶”ì²œ í…Œë§ˆ" class="rounded-lg mb-2 mx-auto"/>
                    <p class="text-center">í…Œë§ˆë¥¼ ì •í•˜ê³  ëœë¤ì—¬í–‰ì§€ ì¶”ì²œë²„íŠ¼ì„ ëˆ„ë¥´ë©´<br>ëœë¤ìœ¼ë¡œ ì—¬í–‰ì§€ë¥¼ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!</p>
                </div>

                <div>
                    <img src="/images/button.png" alt="ì¶”ì²œë²„íŠ¼" class="rounded-lg mb-2 mx-auto"/>
                </div>

                <div>
                    <img src="/images/result.png" alt="ì½”ìŠ¤ ì˜ˆì‹œ" class="rounded-lg mb-2 mx-auto"/>
                    <p class="text-center">ê° ê²°ê³¼ í•­ëª©ì„ í´ë¦­í•˜ë©´ ë„¤ì´ë²„ ì§€ë„ ê²€ìƒ‰ê²°ê³¼ë¡œ ì´ë™í•´ìš”!</p>
                </div>

                <div class="text-center">
                    <img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" alt="ì¹´ì¹´ì˜¤ ê³µìœ " class="inline-block mb-2"/>
                    <p>ê²°ê³¼ë¥¼ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì¹œêµ¬ë‚˜ ê°€ì¡±ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”!</p>
                </div>
            </div>
        </div>
    </div>
</main>
<footer class="footer">
    ë³¸ ì‚¬ì´íŠ¸ëŠ” í•œêµ­ê´€ê´‘ê³µì‚¬ Tour APIë¥¼ í™œìš©í•˜ì—¬ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.<br>
    Â©2025 Mujakjung. All rights reserved.
</footer>
<script th:src="@{/js/mapMarker.js}" defer></script>
<script defer th:src="@{/js/description.js}"></script>
<script th:inline="javascript">
    const kakaoAppKey = /*[[${@environment.getProperty('kakao.map.Key')}]]*/ 'default-key';
</script>

<script th:src="@{/js/kakaoShare.js}" defer></script>
<script th:src="@{/js/hotSection.js}" defer></script>
<script th:src="@{/js/resultTap.js}" defer></script>
<script defer th:src="@{/js/modalAndShare.js}"></script>
<script defer>
    document.addEventListener('DOMContentLoaded', () => {
        const themeSelect   = document.getElementById('theme-select');
        const themeOptions  = document.getElementById('theme-options');
        const regionSelect  = document.getElementById('region-select');
        const seasonSelect  = document.getElementById('season-select');
        const mbtiSelect    = document.getElementById('mbti-select');

        function updateThemeOptions() {
            const v = themeSelect.value;
            // â€œëª¨ë‘ ëœë¤â€ ì„ íƒ ì‹œ ì»¨í…Œì´ë„ˆ ìì²´ ìˆ¨ê¸°ê¸°
            if (v === 'random') {
                themeOptions.classList.add('hidden');
            } else {
                themeOptions.classList.remove('hidden');
                // ê° ì˜µì…˜ ì…‹ì„ ëª¨ë‘ ìˆ¨ê¸´ ë’¤, ì„ íƒëœ ê²ƒë§Œ ë³´ì´ê²Œ
                regionSelect.classList.toggle('hidden', v !== 'region');
                seasonSelect.classList.toggle('hidden', v !== 'season');
                mbtiSelect.classList.toggle('hidden', v !== 'mbti');
            }
        }

        // ì„ íƒ ë³€ê²½ ê°ì§€
        themeSelect.addEventListener('change', updateThemeOptions);
        // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
        updateThemeOptions();
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        let currentCourseId = null;
        let currentDetail   = null;  // â˜… í´ë¦­ í•¸ë“¤ëŸ¬ì—ì„œ ì°¸ì¡°í•  ì›ë³¸ ê°ì²´

        // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ GET /like-status ë¡œ ìƒíƒœ ì¡°íšŒ
        window.openModal = async function(detail) {
            resetLikeButton();
            currentCourseId = detail.id;
            currentDetail   = detail;

            try {
                const res = await fetch(`/course/${currentCourseId}/like-status`);
                if (!res.ok) throw new Error(res.statusText);
                const {liked,totalLikes} = await res.json();


                // ğŸ”¸ detail(list)Â·currentDetail(ëª¨ë‹¬) ëª¨ë‘ ìµœì‹ í™”
                Object.assign(detail, {
                    liked,
                    likeCount: totalLikes
                });
                currentDetail = detail;
            } catch (err) {
                console.error('ì¢‹ì•„ìš” ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', err);
                // ì¡°íšŒ ì‹¤íŒ¨í•´ë„ ê¸°ì¡´ detail ê°’ ì‚¬ìš©í•˜ë˜, ê¸°ë³¸ê°’ ì„¤ì •
                currentDetail.liked = currentDetail.liked || false;
                currentDetail.likeCount = currentDetail.likeCount || 0;
            }

            // ëª¨ë‹¬ UI ì—…ë°ì´íŠ¸ (í•­ìƒ currentDetailì˜ ìµœì‹  ê°’ ì‚¬ìš©)
            document.getElementById('modal-img').src = detail.imgPath;
            document.getElementById('modal-title').textContent = detail.name;
            document.getElementById('modal-like').textContent = currentDetail.likeCount;
            document.getElementById('modal-desc').textContent = detail.description;
            document.getElementById('detail-modal').style.display = 'flex';
            const likeBtn = document.getElementById('like-btn');
            likeBtn.style.pointerEvents = 'none';        // í´ë¦­ ëª» ë°›ê²Œ
            // 120 ms ì •ë„ë©´ ëª¨ë°”ì¼ì—ì„œë„ ì¶©ë¶„íˆ ì•ˆì „
            setTimeout(() => { likeBtn.style.pointerEvents = ''; }, 120);
            // ì¢‹ì•„ìš” ë²„íŠ¼ ìƒíƒœ ë°˜ì˜
            resetLikeButton();
            updateLikeButtonState();

            // ì´ì „/ë‹¤ìŒ ìˆ¨ê¸°ê¸°
            document.getElementById('modal-prev-btn').classList.add('hidden');
            document.getElementById('modal-next-btn').classList.add('hidden');
            document.getElementById('modal-page').classList.add('hidden');
        };

        // ì¢‹ì•„ìš” ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ë¶„ë¦¬
        function updateLikeButtonState() {
            const likeBtn = document.getElementById('like-btn');
            const icon = likeBtn.querySelector('i');

            if (currentDetail.liked) {
                likeBtn.disabled = true;
                likeBtn.classList.add('opacity-50', 'cursor-not-allowed');
                likeBtn.classList.remove('hover:text-blue-600');
                icon.classList.add('text-blue-600');
                icon.classList.remove('text-gray-500', 'hover:text-blue-600');
                icon.classList.add('text-blue-600');  // ëˆŒë €ì„ ë•Œ íŒŒë€ìƒ‰
            } else {
                likeBtn.disabled = false;
                likeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                likeBtn.classList.add('hover:text-blue-600');
                icon.classList.remove('text-blue-600');
                icon.classList.remove('text-blue-600');
                icon.classList.add('text-gray-500');  // ì•„ì§ ì•ˆ ëˆŒë €ì„ ë•Œ íšŒìƒ‰
            }
        }

        function resetLikeButton() {
            const likeBtn = document.getElementById('like-btn');
            likeBtn.disabled = false;
            likeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            likeBtn.querySelector('i').classList.remove('text-blue-600');
        }

        // ì¢‹ì•„ìš” í† ê¸€(POST)ì€ í•œ ë²ˆë§Œ ë°”ì¸ë”©
        const likeBtn = document.getElementById('like-btn');
        likeBtn.addEventListener('click', async () => {
             if (currentDetail.liked) {
                   alert('ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.');
                   return;
             }

            // ë²„íŠ¼ ì¦‰ì‹œ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
            likeBtn.disabled = true;
            likeBtn.classList.add('opacity-50');

            try {
                const res = await fetch(`/course/${currentCourseId}/like`, { method: 'POST' });
                if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);

                const { liked, totalLikes } = await res.json();

                Object.assign(currentDetail, {
                    liked: true,
                    likeCount: totalLikes
                });

                // 2) í™”ë©´ UI ì—…ë°ì´íŠ¸
                document.getElementById('modal-like').textContent = totalLikes;
                updateLikeButtonState();

                console.log('ì¢‹ì•„ìš” ì²˜ë¦¬ ì™„ë£Œ:', { liked, totalLikes });

            } catch (err) {
                console.error('ì¢‹ì•„ìš” ì—ëŸ¬:', err);
                alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');

                // ì—ëŸ¬ ë°œìƒ ì‹œ ë²„íŠ¼ ìƒíƒœ ë³µì›
                likeBtn.disabled = false;
                likeBtn.classList.remove('opacity-50');
            }
        });

        // ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
        const closeModal = document.getElementById('close-modal');
        if (closeModal) {
            closeModal.addEventListener('click', () => {
                document.getElementById('detail-modal').style.display = 'none';
                currentCourseId = null;
                currentDetail = null;
            });
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        const detailModal = document.getElementById('detail-modal');
        if (detailModal) {
            detailModal.addEventListener('click', (e) => {
                if (e.target === detailModal) {
                    detailModal.style.display = 'none';
                    currentCourseId = null;
                    currentDetail = null;
                }
            });
        }
    });

</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.body.addEventListener('error', function (e) {
            const target = e.target;
            if (target.tagName === 'IMG' && !target.dataset.defaulted) {
                target.src = '/images/default.png';
                target.dataset.defaulted = 'true';
            }
        }, true);
    });
</script>
</body>
</html>
